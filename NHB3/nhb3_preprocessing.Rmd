---
title: "Preprocessing NHB3"
author: "Youssef Amin and Angelika Stefan"
output: html_document
---

## Load Packages

```{r setup}
library(dplyr)
```

## Read in dataset

```{r}
nhb3 <- read.csv('../../data/nhb3_raw_data.csv') 
nhb3 <- nhb3[-c(1:2), ] # skip two rows that contain column header info
```

## Remove data from survey testing trial runs

```{r}
nhb3 <- nhb3[nhb3$PROLIFIC_PID != "", ]
```

## Remove time and click recording variables

These variables won't be analyzed as part of the study.

```{r}
nhb3 <- nhb3[, !grepl("timeRecord_", colnames(nhb3))]
nhb3 <- nhb3[, !grepl("Click", colnames(nhb3))]
nhb3 <- nhb3[, !grepl("Submit", colnames(nhb3))]
```

## Remove potentially identifiable variables from publicly shared dataset

We remove personally identifiable information such as Prolific / MTurk IDs, location information, time stamps, and IP addresses from the publicly shared data to fulfill our duty of confidentiality to participants. The raw dataset can be obtained from any member of the research group upon reasonable request.

```{r}
nhb3 <- nhb3[, ! colnames(nhb3) %in% c("IPAddress", 
                                       "RecipientFirstName",
                                       "RecipientLastName",
                                       "RecipientEmail",
                                       "ExternalReference",
                                       "LocationLatitude",
                                       "LocationLongitude",
                                       "prolific_id",
                                       "mturkcode",
                                       "PROLIFIC_PID",
                                       "city",
                                       "zip",
                                       "workerId")]
```

## Exclude participants based on failed attention check

```{r}
ssbefore <- nrow(nhb3)
nhb3 <- nhb3[nhb3$skyColor == 'purple', ]
ssafter <- nrow(nhb3)
```

We recruited `r ssbefore` participants on Prolific. `r ssbefore-ssafter` participants were excluded because they failed the attention check. `r ssafter` participants remain in the sample.

## Check if people correctly assigned themselves to their group

Participants were asked: "Please indicate the group that you belong to by placing \"Me\" in the correct group". The allocation is recorded in the variables `AttCheckOrder1` and `AttCheckOrder2`. Only one response is collected per participant across both variables. Correct allocation is as follows:

__AttCheckOrder1__

    - if ingroup == "green", group 1 (AttCheckOrder1_1_GROUP) should not be empty
    - if ingroup == "red",  group 0 (AttCheckOrder1_0_GROUP) should not be empty
    
__AttCheckOrder2__

    - if ingroup == "green", group 0 (AttnCheckOrder2_0_GROUP) should not be empty
    - if ingroup == "red",  group 1 (AttnCheckOrder2_1_GROUP) should not be empty


```{r}
# Create a new variable that records whether participants correctly assigned themselves (1 = yes, 0 = no)
nhb3$AssignCheck <- case_when(
  nhb3$ingroup=="green" & (nhb3$AttCheckOrder1_1_GROUP != "" | nhb3$AttnCheckOrder2_0_GROUP != "") ~ 1,
  nhb3$ingroup=="red" & (nhb3$AttCheckOrder1_0_GROUP != "" | nhb3$AttnCheckOrder2_1_GROUP != "") ~ 1,
  TRUE ~ 0
)
```

In total, `r sum(nhb3$AssignCheck == 0)` participants did not assign themselves to the correct group. 

- `r sum(nhb3$AttCheckOrder1_1_GROUP == "" & nhb3$AttnCheckOrder2_0_GROUP == "" & nhb3$AttCheckOrder1_0_GROUP == "" & nhb3$AttnCheckOrder2_1_GROUP == "")` participants did not answer the question (i.e., they did not assign themselves to any group)
- `r nrow(nhb3[nhb3$AssignCheck == 0 & nhb3$ingroup == "green" & (nhb3$AttCheckOrder1_0_GROUP != "" | nhb3$AttnCheckOrder2_1_GROUP != ""), ])` participants in the green group incorrectly assigned themselves to the red group
- `r nrow(nhb3[nhb3$AssignCheck == 0 & nhb3$ingroup == "red" & (nhb3$AttCheckOrder1_1_GROUP != "" | nhb3$AttnCheckOrder2_0_GROUP != ""), ])` participants in the red group incorrectly assigned themselves to the green group

Since we did not preregister this as an exclusion criterion, we __will not exclude participants__ who allocated themselves in the wrong group. However, these numbers are important to contextualize data quality.

## Demographics data cleaning

Manually code open text responses for gender:

```{r}
nhb3$dem_Sex <- case_match(nhb3$dem_Sex,
                           c("Female", "female ", "female", "Female ", "F",
                             "woman", "fema;e", "f", "Woman", "FEMALE",
                             "Femae", " Female", "Femal", "cisgender woman",
                             "Woman ", "fema;le", " female ", "Fenale",
                             "Natural Female ", "Femle ", "Femalew", "femlae",
                             "Women") ~ "female",
                           c("male", "Male", "Male ", "man", "male ", "nale",
                             "Man", "MALE", "m", "M", "Make", "mail", "male0",
                             "men", "mALE") ~ "male",
                           c("Nonbinary", "Non-Binary", 
                             "Nonbinary assigned female at birth", 
                             "Nonbinary Transfem", "nonbinary",
                             "Fem nonbinary ","non-binary",
                             "Non-binary", "DemiMan", "genderqueer",
                             "Non binary ", "Non-binary ", "AFAB, genderfluid",
                             "Agender ", "Feo", "enby", 
                             "non binary") ~ "non-binary",
                           .default = "missing")
```

Recode Education

```{r}
# Code missing as NA and summarize professional and doctoral degree
nhb3$dem_Education <- case_match(nhb3$dem_Education,
                                 "" ~ NA,
                                 c("Professional Degree (JD, MD)", 
                                 "Doctoral Degree") ~ "Professional or Doctoral Degree (JD, MD, PhD)",
                                  .default = nhb3$dem_Education)
```

Recode Race

```{r}
nhb3$dem_Race_recoded <- case_when(
  nhb3$dem_Race == "Black or African American" ~ "Black",
  nhb3$dem_Race == "White" ~ "White",
  nhb3$dem_Race == "Asian" ~ "Asian",
  nhb3$dem_Race == "American Indian or Alaskan Native" ~ "Native",
  nhb3$dem_Race == "Native Hawaiian or Other Pacific Islander" ~ "Pacific Islander",
  nhb3$dem_Race %in% c(
    "Black or African American,Asian",
    "Black or African American,White",
    "American Indian or Alaskan Native,White",
    "White,Asian",
    "Black or African American,American Indian or Alaskan Native,White",
    "White,Native Hawaiian or Other Pacific Islander",
    "Asian,Native Hawaiian or Other Pacific Islander",
    "White,Asian,Native Hawaiian or Other Pacific Islander",
    "Black or African American,American Indian or Alaskan Native",
    "Black or African American,White,Native Hawaiian or Other Pacific Islander",
    "American Indian or Alaskan Native,White,Asian",
    "White,Native Hawaiian or Other Pacific Islander,Other (please specify):") ~ "Multiracial",
  nhb3$dem_Race == "Other (please specify):" & nhb3$dem_Race_7_TEXT %in% c(
    "Hispanic", 
    "Hispanic ",
    "Chicano",
    "hispanic",
    "mexican",
    "Hispanic or Latino",
    "Latino",
    "latina",
    "Mexican",
    "Hispanic / Latino",
    "Latina") ~ "Hispanic",
  nhb3$dem_Race == "Other (please specify):" & nhb3$dem_Race_7_TEXT %in% c(
    "supposed to put white but I don't have the privileges ",
    "White Hispanic ") ~ "White",
  nhb3$dem_Race == "Other (please specify):" & nhb3$dem_Race_7_TEXT %in% c(
    "Mixed",
    "Caucasian and South Asian Indian (Kannadiga)",
    "mixed",
    "Metis",
    "Multiracial",
    "two races",
    "biracial"
  ) ~ "Multiracial",
  nhb3$dem_Race == "Other (please specify):" & nhb3$dem_Race_7_TEXT %in% c(
    "Caribbean American",
    "Sephardic Jew"
  ) ~ "Other Non-White",
  nhb3$dem_Race == "White,Other (please specify):" & nhb3$dem_Race_7_TEXT %in% c(
    "Hispanic (Spain)",
    "Hispanic",
    "hispanic",
    "Mexican American",
    "hispanic/latino"
  ) ~ "Multiracial",
  nhb3$dem_Race == "American Indian or Alaskan Native,Other (please specify):" & nhb3$dem_Race_7_TEXT %in% c(
    "Latino"
  ) ~ "Multiracial",
  .default = "Did not specify"
                                   )
```

## Calculate scale values for political ideology / extremity

SECS scale

```{r}
# Change variable type to numeric
nhb3[grepl("SECS", colnames(nhb3))] <- apply(nhb3[grepl("SECS", colnames(nhb3))], 2, as.numeric)

# Recode item 1 and 5 such that higher values = more conservative
nhb3 <- nhb3 %>%
  mutate(RC_SECS_1 = 100 - SECS_1,
         RC_SECS_5 = 100 - SECS_5)

# Compute item means per participant
nhb3$mean_SECS <- rowMeans(nhb3[,c("RC_SECS_1",
                                   paste0("SECS_", 2:4), 
                                   "RC_SECS_5",
                                   paste0("SECS_", 6:12))], na.rm = TRUE)

```

Recode economic orientation item

```{r}
nhb3$EconOrient<-case_match(nhb3$EconOrient,
                            "Extremely Liberal\n1\n" ~ 1,
                            "2" ~ 2, 
                            "3" ~ 3,
                            "4" ~ 4,
                            "Moderate\n5\n" ~ 5,
                            "6" ~ 6,
                            "7" ~ 7,
                            "8" ~ 8,
                            "Extremely Conservative\n9\n" ~ 9,
                            "" ~ NA_real_)
```

Recode social orientation item

```{r}
nhb3$SocOrient<-case_match(nhb3$SocOrient,
                           "Extremely Liberal\n1\n" ~ 1,
                           "2" ~ 2, 
                           "3" ~ 3,
                           "4" ~ 4,
                           "Moderate\n5\n" ~ 5,
                           "6" ~ 6,
                           "7" ~ 7,
                           "8" ~ 8,
                           "Extremely Conservative\n9\n" ~ 9,
                           "" ~ NA_real_)
```

Recode political orientation item

```{r}
nhb3$PolOrient<-case_match(nhb3$PolOrient,
                           "Extremely Liberal\n1\n" ~ 1,
                           "2" ~ 2, 
                           "3" ~ 3,
                           "4" ~ 4,
                           "Moderate\n5\n" ~ 5,
                           "6" ~ 6,
                           "7" ~ 7,
                           "8" ~ 8,
                           "Extremely Conservative\n9\n" ~ 9,
                           "" ~ NA_real_)
```

Standardize the four political orientation variables

```{r}
nhb3$z_mean_SECS <- scale(nhb3$mean_SECS)
nhb3$z_EconOrient <- scale(nhb3$EconOrient)
nhb3$z_SocOrient <- scale(nhb3$SocOrient)
nhb3$z_PolOrient <- scale(nhb3$PolOrient)
```

Compute composite political orientation variables

```{r}
nhb3$composite_political_orientation <- rowMeans(nhb3[, grepl("z_", colnames(nhb3))], na.rm = TRUE)
nhb3$self_identification_political <- rowMeans(nhb3[, c("z_PolOrient","z_EconOrient","z_SocOrient")], na.rm = TRUE)
```

Standardize composite political orientation variables

```{r}
nhb3$composite_political_orientation_z = scale(nhb3$composite_political_orientation)
nhb3$self_identification_political_z = scale(nhb3$self_identification_political)
```

Compute ideological extremity measure

```{r}
# Compute absolute distance from scale midpoint
nhb3$PolOrientExtremity <- abs(5-nhb3$PolOrient)
nhb3$SocOrientExtremity <- abs(5-nhb3$SocOrient)
nhb3$EconOrientExtremity <- abs(5-nhb3$EconOrient)
nhb3$SECSExtremity <- abs(50-nhb3$mean_SECS)

# Standardize extremity variables
nhb3$z_PolOrientExtremity <- scale(nhb3$PolOrientExtremity)
nhb3$z_SocOrientExtremity <- scale(nhb3$SocOrientExtremity)
nhb3$z_EconOrientExtremity <- scale(nhb3$EconOrientExtremity)
nhb3$z_SECSExtremity <- scale(nhb3$SECSExtremity)

# Compute mean ideological extremity
nhb3$composite_ideological_extremity <- rowMeans(nhb3[, c("z_PolOrientExtremity", "z_SocOrientExtremity", "z_EconOrientExtremity", "z_SECSExtremity")], na.rm = TRUE)
nhb3$selfIDExtremity <- rowMeans(nhb3[, c("z_PolOrientExtremity", "z_SocOrientExtremity", "z_EconOrientExtremity")], na.rm = TRUE)
```

Standardize ideological extremity variables

```{r}
nhb3$composite_ideological_extremity_z <- scale(nhb3$composite_ideological_extremity)
nhb3$selfIDExtremity_z <- scale(nhb3$selfIDExtremity)
```

## Calculate group identification measures

Recode ingroup and outgroup identification

```{r}
nhb3$IngroupIdentify <- case_match(nhb3$IngroupIdentify,
                                       "Strongly Disagree\n1\n" ~ 1,
                                       "2" ~ 2,
                                       "3" ~ 3,
                                       "4" ~ 4,
                                       "5" ~ 5,
                                       "6" ~ 6,
                                       "Strongly Agree\n7\n" ~ 7)

nhb3$OutgroupIdentify <- case_match(nhb3$OutgroupIdentify,
                                     "Strongly Disagree\n1\n" ~ 1,
                                     "2" ~ 2,
                                     "3" ~ 3,
                                     "4" ~ 4,
                                     "5" ~ 5,
                                     "6" ~ 6,
                                     "Strongly Agree\n7\n" ~ 7)
```

Standardize ingroup and outgroup identification measures

```{r}
nhb3$z_IngroupIdentify <- scale(nhb3$IngroupIdentify)
nhb3$z_OutgroupIdentify <- scale(nhb3$OutgroupIdentify)
```

Calculate (standardized) difference between ingroup and outgroup identification

```{r}
nhb3$ingroup_minus_outgroup_identify <- nhb3$IngroupIdentify - nhb3$OutgroupIdentify
nhb3$z_ingroup_minus_outgroup_identify <- scale(nhb3$ingroup_minus_outgroup_identify)
```

## Compute evaluative trait ratings

Recode ingroup and outgroup trait evaluation ratings

```{r}
# Define function for recoding
traitrecode <- function(item){
  case_match(item,
             "Not at all\n1\n" ~ 1,
             "2" ~  2,
             "3" ~  3,
             "4" ~  4,
             "5" ~  5,
             "6" ~  6,
             "Very much\n7\n" ~  7)
}

# Convert scores to numeric values
nhb3$InTraits_1 <- traitrecode(nhb3$InTraits_1)
nhb3$InTraits_2 <- traitrecode(nhb3$InTraits_2)
nhb3$InTraits_3 <- traitrecode(nhb3$InTraits_3)
nhb3$InTraits_4 <- traitrecode(nhb3$InTraits_4)
nhb3$InTraits_5 <- traitrecode(nhb3$InTraits_5)
nhb3$InTraits_6 <- traitrecode(nhb3$InTraits_6)
nhb3$OutTraits_1 <- traitrecode(nhb3$OutTraits_1)
nhb3$OutTraits_2 <- traitrecode(nhb3$OutTraits_2)
nhb3$OutTraits_3 <- traitrecode(nhb3$OutTraits_3)
nhb3$OutTraits_4 <- traitrecode(nhb3$OutTraits_4)
nhb3$OutTraits_5 <- traitrecode(nhb3$OutTraits_5)
nhb3$OutTraits_6 <- traitrecode(nhb3$OutTraits_6)

# Recode negative trait ratings so that higher scores = more positive evaluations
nhb3$RC_InTraits_1 <- 8-nhb3$InTraits_1
nhb3$RC_InTraits_4 <- 8-nhb3$InTraits_4
nhb3$RC_InTraits_6 <- 8-nhb3$InTraits_6
nhb3$RC_OutTraits_1 <- 8-nhb3$OutTraits_1
nhb3$RC_OutTraits_4 <- 8-nhb3$OutTraits_4
nhb3$RC_OutTraits_6 <- 8-nhb3$OutTraits_6
```

Calculate mean evaluative trait ratings for ingroups and outgroups, such that higher scores = more positive evaluations.

```{r}
nhb3$mean_ingroup_traits_positive <- rowMeans(nhb3[, c("RC_InTraits_1","InTraits_2","InTraits_3", "RC_InTraits_4","InTraits_5","RC_InTraits_6")], na.rm = TRUE)
nhb3$mean_outgroup_traits_positive <- rowMeans(nhb3[, c("RC_OutTraits_1","OutTraits_2","OutTraits_3", "RC_OutTraits_4","OutTraits_5","RC_OutTraits_6")], na.rm = TRUE)
```

Standardize mean evaluative trait ratings

```{r}
nhb3$z_IngroupTraits <- scale(nhb3$mean_ingroup_traits_positive)
nhb3$z_OutgroupTraits <- scale(nhb3$mean_outgroup_traits_positive)
```

Calculate the (standardized) difference score between positivity of ingroup trait ratings and outgroups trait ratings

```{r}
nhb3$ingroup_minus_outgroup_traits_positive <- nhb3$mean_ingroup_traits_positive - nhb3$mean_outgroup_traits_positive
nhb3$z_ingroup_minus_outgroup_traits_positive <- scale(nhb3$ingroup_minus_outgroup_traits_positive)
```


## Tajfel matrices

Recode Tajfel matrix choices to number of points awarded to ingroup and outgroup

```{r}
# Matrix 1: FAV vs. MJP OPPOSED
nhb3$MatrixA_O_ingroup_points <- case_match(nhb3$MatrixA_O,
                                             "A" ~ 19,
                                             "B" ~ 18,
                                             "C" ~ 17,
                                             "D" ~ 16,
                                             "E" ~ 15,
                                             "F" ~ 14,
                                             "G" ~ 13,
                                             "H" ~ 12,
                                             "I" ~ 11,
                                             "J" ~ 10,
                                             "K" ~ 9,
                                             "L" ~ 8,
                                             "M" ~ 7)
nhb3$MatrixA_O_outgroup_points <- case_match(nhb3$MatrixA_O,
                                              "A" ~ 1,
                                              "B" ~ 3,
                                              "C" ~ 5,
                                              "D" ~ 7,
                                              "E" ~ 9,
                                              "F" ~ 11,
                                              "G" ~ 13,
                                              "H" ~ 15,
                                              "I" ~ 17,
                                              "J" ~ 19,
                                              "K" ~ 21,
                                              "L" ~ 23,
                                              "M"~ 25)

# Matrix 2: FAV vs. MJP Together
nhb3$MatrixA_T_ingroup_points <- case_match(nhb3$MatrixA_T,
                                             "A" ~ 25,
                                             "B" ~ 23,
                                             "C" ~ 21,
                                             "D" ~ 19,
                                             "E" ~ 17,
                                             "F" ~ 15,
                                             "G" ~ 13,
                                             "H" ~ 11,
                                             "I" ~ 9,
                                             "J" ~ 7,
                                             "K" ~ 5,
                                             "L" ~ 3,
                                             "M"~ 1)
nhb3$MatrixA_T_outgroup_points <- case_match(nhb3$MatrixA_T,
                                              "A" ~ 7,
                                              "B" ~ 8,
                                              "C" ~ 9,
                                              "D" ~ 10,
                                              "E" ~ 11,
                                              "F" ~ 12,
                                              "G" ~ 13,
                                              "H" ~ 14,
                                              "I" ~ 15,
                                              "J" ~ 16,
                                              "K" ~ 17,
                                              "L" ~ 18,
                                              "M" ~ 19)

# Matrix 3: MD vs. MIP+MJP opposed
nhb3$MatrixB_O_ingroup_points <- case_match(nhb3$MatrixB_O,
                                             "A" ~ 19,
                                             "B" ~ 18,
                                             "C" ~ 17,
                                             "D" ~ 16,
                                             "E" ~ 15,
                                             "F" ~ 14,
                                             "G" ~ 13,
                                             "H" ~ 12,
                                             "I" ~ 11,
                                             "J" ~ 10,
                                             "K" ~ 9,
                                             "L" ~ 8,
                                             "M" ~ 7)
nhb3$MatrixB_O_outgroup_points <- case_match(nhb3$MatrixB_O,
                                              "A" ~ 25,
                                              "B" ~ 23,
                                              "C" ~ 21,
                                              "D" ~ 19,
                                              "E" ~ 17,
                                              "F" ~ 15,
                                              "G" ~ 13,
                                              "H" ~ 11,
                                              "I" ~ 9,
                                              "J" ~ 7,
                                              "K" ~ 5,
                                              "L" ~ 3,
                                              "M" ~ 1)

# Matrix 4: MD vs. MIP+MJP Together
nhb3$MatrixB_T_ingroup_points <- case_match(nhb3$MatrixB_T,
                                             "A" ~ 1,
                                             "B" ~ 3,
                                             "C" ~ 5,
                                             "D" ~ 7,
                                             "E" ~ 9,
                                             "F" ~ 11,
                                             "G" ~ 13,
                                             "H" ~ 15,
                                             "I" ~ 17,
                                             "J" ~ 19,
                                             "K" ~ 21,
                                             "L" ~ 23,
                                             "M" ~ 25)
nhb3$MatrixB_T_outgroup_points <- case_match(nhb3$MatrixB_T,
                                              "A" ~ 7,
                                              "B" ~ 8,
                                              "C" ~ 9,
                                              "D" ~ 10,
                                              "E" ~ 11,
                                              "F" ~ 12,
                                              "G" ~ 13,
                                              "H" ~ 14,
                                              "I" ~ 15,
                                              "J" ~ 16,
                                              "K" ~ 17,
                                              "L" ~ 18,
                                              "M" ~ 19)

# Matrix 5: P Vs. FAV Opposed
nhb3$MatrixC_O_ingroup_points <- case_match(nhb3$MatrixC_O,
                                             "A" ~ 16,
                                             "B" ~ 17,
                                             "C" ~ 18,
                                             "D" ~ 19,
                                             "E" ~ 20,
                                             "F" ~ 21,
                                             "G" ~ 22,
                                             "H" ~ 23,
                                             "I" ~ 24,
                                             "J" ~ 25,
                                             "K" ~ 26,
                                             "L" ~ 27,
                                             "M" ~ 28)
nhb3$MatrixC_O_outgroup_points <- case_match(nhb3$MatrixC_O,
                                              "A" ~ 16,
                                              "B" ~ 15,
                                              "C" ~ 14,
                                              "D" ~ 13,
                                              "E" ~ 12,
                                              "F" ~ 11,
                                              "G" ~ 10,
                                              "H" ~ 9,
                                              "I" ~ 8,
                                              "J" ~ 7,
                                              "K" ~ 6,
                                              "L" ~ 5,
                                              "M" ~ 4)

# Matrix 6: P Vs. FAV Together
nhb3$MatrixC_T_ingroup_points <- case_match(nhb3$MatrixC_T,
                                             "A" ~ 4,
                                             "B" ~ 5,
                                             "C" ~ 6,
                                             "D" ~ 7,
                                             "E" ~ 8,
                                             "F" ~ 9,
                                             "G" ~ 10,
                                             "H" ~ 11,
                                             "I" ~ 12,
                                             "J" ~ 13,
                                             "K" ~ 14,
                                             "L" ~ 15,
                                             "M" ~ 16)
nhb3$MatrixC_T_outgroup_points <- case_match(nhb3$MatrixC_T,
                                              "A" ~ 28,
                                              "B" ~ 27,
                                              "C" ~ 26,
                                              "D" ~ 25,
                                              "E" ~ 24,
                                              "F" ~ 23,
                                              "G" ~ 22,
                                              "H" ~ 21,
                                              "I" ~ 20,
                                              "J" ~ 19,
                                              "K" ~ 18,
                                              "L" ~ 17,
                                              "M" ~ 16)
```

Calculate total number of ingroup and outgroup points

```{r}
nhb3$total_ingroup_points <- rowSums(nhb3[, c("MatrixA_O_ingroup_points","MatrixA_T_ingroup_points","MatrixB_O_ingroup_points","MatrixB_T_ingroup_points","MatrixC_O_ingroup_points","MatrixC_T_ingroup_points")])
nhb3$total_outgroup_points <- rowSums(nhb3[, c("MatrixA_O_outgroup_points","MatrixA_T_outgroup_points","MatrixB_O_outgroup_points","MatrixB_T_outgroup_points","MatrixC_O_outgroup_points","MatrixC_T_outgroup_points")])
```

Standardize total number of ingroup and outgroup points

```{r}
nhb3$z_IngroupPoints <- scale(nhb3$total_ingroup_points)
nhb3$z_OutgroupPoints <- scale(nhb3$total_outgroup_points)
```

Calculate (standardized) difference between total number of points awarded to ingroup and outgroup

```{r}
nhb3$total_ingroup_minus_outgroup_points <- nhb3$total_ingroup_points-nhb3$total_outgroup_points
nhb3$z_total_ingroup_minus_outgroup_points <- scale(nhb3$total_ingroup_minus_outgroup_points)
```

Calculating relative pull factors

```{r}
# Matrix A: Pull of FAV on MJP and vice versa

# Ranking of opposed and together matrix
nhb3$MatrixA_O_Ranking <- case_match(nhb3$MatrixA_O,
                                      'M' ~ 0,
                                      'L' ~ 1,
                                      'K' ~ 2,
                                      'J' ~ 3,
                                      'I' ~ 4,
                                      'H' ~ 5,
                                      'G' ~ 6,
                                      'F' ~ 7,
                                      'E' ~ 8,
                                      'D' ~ 9,
                                      'C' ~ 10,
                                      'B' ~ 11,
                                      'A' ~ 12)
nhb3$MatrixA_T_Ranking <- case_match(nhb3$MatrixA_T,
                                      'M' ~ 12,
                                      'L' ~ 11,
                                      'K' ~ 10,
                                      'J' ~ 9,
                                      'I' ~ 8,
                                      'H' ~ 7,
                                      'G' ~ 6,
                                      'F' ~ 5,
                                      'E' ~ 4,
                                      'D' ~ 3,
                                      'C' ~ 2,
                                      'B' ~ 1,
                                      'A' ~ 0)

##Subtract to get pulls
nhb3$Pull_FAVonMJP<-nhb3$MatrixA_O_Ranking-nhb3$MatrixA_T_Ranking
nhb3$Pull_MJPonFAV<-(12-nhb3$MatrixA_O_Ranking)-nhb3$MatrixA_T_Ranking

# Matrix B: Pull of MD on Profit and vice versa

# Ranking for opposed and together matrix
nhb3$MatrixB_O_Ranking <- case_match(nhb3$MatrixB_O,
                                      'M' ~ 12,
                                      'L' ~ 11,
                                      'K' ~ 10,
                                      'J' ~ 9,
                                      'I' ~ 8,
                                      'H' ~ 7,
                                      'G' ~ 6,
                                      'F' ~ 5,
                                      'E' ~ 4,
                                      'D' ~ 3,
                                      'C' ~ 2,
                                      'B' ~ 1,
                                      'A' ~ 0)
nhb3$MatrixB_T_Ranking <- case_match(nhb3$MatrixB_T,
                                      'M' ~ 0,
                                      'L' ~ 1,
                                      'K' ~ 2,
                                      'J' ~ 3,
                                      'I' ~ 4,
                                      'H' ~ 5,
                                      'G' ~ 6,
                                      'F' ~ 7,
                                      'E' ~ 8,
                                      'D' ~ 9,
                                      'C' ~ 10,
                                      'B' ~ 11,
                                      'A' ~ 12)


# Subtract to get pulls
nhb3$Pull_MDonProfit<-nhb3$MatrixB_O_Ranking-nhb3$MatrixB_T_Ranking
nhb3$Pull_ProfitonMD<-(12-nhb3$MatrixB_O_Ranking)-nhb3$MatrixB_T_Ranking

# Matrix C: Pull of P on FAV and vice versa

# Ranking of opposed and together matrix
nhb3$MatrixC_O_Ranking <- case_match(nhb3$MatrixC_O,
                                      'M' ~ 0,
                                      'L' ~ 1,
                                      'K' ~ 2,
                                      'J' ~ 3,
                                      'I' ~ 4,
                                      'H' ~ 5,
                                      'G' ~ 6,
                                      'F' ~ 7,
                                      'E' ~ 8,
                                      'D' ~ 9,
                                      'C' ~ 10,
                                      'B' ~ 11,
                                      'A' ~ 12)
nhb3$MatrixC_T_Ranking <- case_match(nhb3$MatrixC_T,
                                      'M' ~ 0,
                                      'L' ~ 1,
                                      'K' ~ 2,
                                      'J' ~ 3,
                                      'I' ~ 4,
                                      'H' ~ 5,
                                      'G' ~ 6,
                                      'F' ~ 7,
                                      'E' ~ 8,
                                      'D' ~ 9,
                                      'C' ~ 10,
                                      'B' ~ 11,
                                      'A' ~ 12)

##Subtract to get pulls
nhb3$Pull_PonFAV<-nhb3$MatrixC_O_Ranking-nhb3$MatrixC_T_Ranking
nhb3$Pull_FAVonP<-(12-nhb3$MatrixC_O_Ranking)-nhb3$MatrixC_T_Ranking
```

## Create composite intergroup bias measure

(Standardized) mean intergroup bias using the three standardized measures

```{r}
nhb3$mean_intergroup_bias <- rowMeans(nhb3[, c("z_total_ingroup_minus_outgroup_points", "z_ingroup_minus_outgroup_traits_positive", "z_ingroup_minus_outgroup_identify")], na.rm = TRUE)
nhb3$mean_intergroup_bias_z <- scale(nhb3$mean_intergroup_bias)
```

## Create separate ingroup/outgroup indices of intergroup bias

```{r}
nhb3$IngroupIndex <- rowMeans(nhb3[, c("z_IngroupIdentify","z_IngroupTraits","z_IngroupPoints")], na.rm = TRUE)
nhb3$IngroupIndex_z <- scale(nhb3$IngroupIndex)

nhb3$OutgroupIndex <- rowMeans(nhb3[, c("z_OutgroupIdentify","z_OutgroupTraits","z_OutgroupPoints")], na.rm = TRUE)
nhb3$OutgroupIndex_z <- scale(nhb3$OutgroupIndex)
```

## Save processed data

```{r}
write.csv(nhb3, "../../data/nhb3_processed.csv")
```

## System information (for reproducibility)

```{r}
Sys.info()[1:3]
sessionInfo()
```

