---
title: "nhb2_results"
author: "Youssef Amin"
date: "2024-06-05"
output: html_document
---
## Load packages
```{r setup, message=FALSE, warning=FALSE, error = FALSE}
library(bayestestR)
library(BayesFactor)
library(ggtext)
library(interactions)
library(brms)
library(tidyverse)
library(magrittr)
library(bayestestR)
library(BayesFactor)
library(lme4)
library(nlme)
library(logspline)
library(mediation)
library(corrplot)
library(emmeans)
library(Hmisc)
library(reghelper)
library(jtools)
testSlopesBinaryInteraction <- function(modelfit){
  SE <- coef(summary(modelfit))[3,"Std.Error"]
  param_baseline <- coef(summary(modelfit))[3, "Value"]
  param_otherGroup <- coef(summary(modelfit))[4, "Value"] + param_baseline
  tvals <- c(param_baseline, param_otherGroup)/SE
  df <- coef(summary(modelfit))[3,"DF"]
  pvals <- 2*pt(-abs(tvals), df)
  names(pvals) <- c("baseline group", "non-baseline group")
  out <- rbind(pvals, estimates=c(param_baseline, param_otherGroup))
  return(out)
}
```
  
<br>
<br>

## Read in data
```{r}
# Set seed
set.seed (987654)
nhb2 <- read.csv("/Users/youssefamin/Dropbox/MinimalGroup_NHB_Master/MinimalGroup_NHB2/data/nhb2_processed.csv")
nhb2$condition <- factor(nhb2$condition, levels = c("random", "attitude", "volitional"))
demographics <- nhb2 %>% dplyr::select(dem_Age, dem_Education,dem_Income, dem_Race, dem_BasicRace, dem_Sex)
```
  
<br>
<br>

## Demographics
Note: There are over 40 unique gender and 19 unique race responses, they're not displayed here. Please see the preprocessing script.
   
### Age
```{r}
psych::describe(demographics$dem_Age)
```
```{r echo=FALSE}
ggplot(demographics, aes(x = dem_Age)) +
  geom_histogram(binwidth = 5, fill = "steelblue", color = "white") +
  theme_minimal() +
  labs(title = "Age Distribution", x = "Age", y = "Count")
```
  
  
  
  
### Education
```{r, echo=FALSE}
# Reorder Education levels
demographics$dem_Education <- factor(demographics$dem_Education, 
                                 levels = c("Less than High School", "High School / GED", "Some College", 
                                            "2-year College Degree", "4-year College Degree", 
                                            "Masters Degree", "Professional Degree (JD, MD)", 
                                            "Doctoral Degree"))

na.omit(demographics) %>%
  count(dem_Education) %>%
  mutate(percentage = n / sum(n) * 100) %>% 
  ggplot(aes(x = dem_Education, y = n)) +
  geom_bar(stat = "identity", fill = "mediumseagreen", color = "white") +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), vjust = -0.5) +
  theme_minimal() +
  labs(title = "Education Distribution", x = "Education", y = "Count") +
  theme(axis.text.x = element_text(angle = 70, vjust = 1.0, hjust = 1))+
  coord_cartesian(ylim = c(1,500))
```
  
  
  
### Income
```{r, echo=FALSE}
demographics$dem_Income<-dplyr::recode(demographics$dem_Income,
                                       "Less than 30,000" = "Less than $30,000",
                                       "30,000 – 39,999" = "$30,000 – $39,999",
                                       "40,000 – 49,999" = "$40,000 – $49,999",
                                       "50,000 – 59,999" = "$50,000 – $59,999",
                                       "60,000 – 69,999" = "$60,000 – $69,999",
                                       "70,000 – 79,999" = "$70,000 – $79,999",
                                       "80,000 – 89,999" = "$80,000 – $89,999",
                                       "90,000 – 99,999" = "$90,000 – $99,999",
                                       "100,000 or more" = "$100,000 or more")


demographics$dem_Income <- factor(demographics$dem_Income, levels = c("Less than $30,000",
                                       "$30,000 – $39,999",
                                       "$40,000 – $49,999",
                                       "$50,000 – $59,999",
                                       "$60,000 – $69,999",
                                       "$70,000 – $79,999",
                                       "$80,000 – $89,999",
                                       "$90,000 – $99,999",
                                       "$100,000 or more"))

na.omit(demographics) %>%
  count(dem_Income) %>%
  mutate(percentage = n / sum(n) * 100) %>% 
  ggplot(aes(x = dem_Income, y = n)) +
  geom_bar(stat = "identity", fill = "palevioletred1", color = "white") +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), vjust = -0.5) +
  theme_minimal() +
  labs(title = "Income Distribution", x = "Income", y = "Count") +
  theme(axis.text.x = element_text(angle = 55, vjust = 1.0, hjust = 1))+
  coord_cartesian(ylim = c(1,400))
```
  
  
  
  
### Race
```{r, echo=FALSE}
na.omit(demographics) %>%
  count(dem_BasicRace) %>%
  mutate(percentage = n / sum(n) * 100) %>% 
  ggplot(aes(x = dem_BasicRace, y = n)) +
  geom_bar(stat = "identity", fill = "cornflowerblue", color = "white") +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), vjust = -0.5) +
  theme_minimal() +
  labs(title = "Race Distribution", x = "Income", y = "Count") +
  theme(axis.text.x = element_text(angle = 50, vjust = 1.0, hjust = 1))+
  coord_cartesian(ylim = c(1,1000))
```
  
  
  
  
  
### Ideology
```{r echo=FALSE}
ggplot(nhb2, aes(x = composite_political_orientation.raw)) +
  geom_histogram(binwidth = .8, fill = "mediumpurple1", color = "white") +
  theme_minimal() +
  labs(title = "Ideology Distribution", x = "Ideology", y = "Count")
```  
   
      
         
           
<br>
<br>
<br>

# Confirmatory Analyses

## Summary
1. <span style="color:green">Ideology</span> predicts <span style="color:green">intergroup bias</span>. 
2. <span style="color:red">Group type</span> does <span style ="color:red">not</span> strengthen the relationship between <span style="color:red">ideology</span> and <span style="color:red">bias</span>. There is a main effect of the <span style="color:green">attitude</span> condition: it **weakens** the relationship between <span style="color:green">ideology</span> and <span style="color:green">bias</span>
  
  
  
  
<br>
<br>

## Confirmatory 1: <span style="color:green">Ideology</span> predicts <span style="color:green">bias</span>
```{r confirmatory 1 formula}
confirmatory1_formula <- mean_intergroup_bias_z ~ composite_political_orientation_z
```
<br> 

### Compute Frequentist
```{r confirmatory 1 compute frequentist}
confirmatory1_freqmodel <- lm(confirmatory1_formula, nhb2)
```
<br>

### Compute Bayesian
```{r confirmatory 1 compute bayseian, results = 'hide', warning=FALSE, message=FALSE }
### Define priors for the regression model #REMEMBER TO SET warmup = 5000 and iter = 100000
confirmatory1_priors <- c(set_prior("normal(0, 0.5)", class = "b"))

# Run the regression model
confirmatory1_bayesmodel <- brm(
  formula = confirmatory1_formula, 
  data = nhb2, 
  family = gaussian(),
  prior = confirmatory1_priors,
  sample_prior = "no",
  iter = 100000,  # Adjust iterations based on convergence diagnostics
  chains = 4,
  seed = 987654,
  silent = TRUE,
  refresh = 0,
  warmup = 5000
)

confirmatory1_priordraws<- brms::brm(confirmatory1_formula, 
                            data = nhb2, 
                            family = "gaussian",
                            prior = confirmatory1_priors,
                            sample_prior = "only",
                            seed = 987654,
                            silent = TRUE,
                            refresh = 0,
                            iter = 100000)

confirmatory1_bf <- bayesfactor_parameters(confirmatory1_bayesmodel,
                       prior=confirmatory1_priordraws, 
                       direction = "right", 
                       parameters = "composite_political_orientation_z")
```
<br>

```{r confirmatory 1 plot, results='hide', echo=FALSE, warning=FALSE, message=FALSE}
confirmatory1_bf_long <- round(exp(confirmatory1_bf$log_BF), 2) %>% as.character()
confirmatory1_beta <- unname(round(confirmatory1_freqmodel$coefficients[2],2))
confirmatory1_plot <- ggplot(nhb2, aes(x = composite_political_orientation_z, y = mean_intergroup_bias_z, 
                                       color = composite_political_orientation_z)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", color = "black", linetype = "solid") +
  scale_color_gradient2(low = "darkblue", mid = "darkgrey", high = "red", midpoint = 0) +
  labs(
    x = "Ideology (z-scored)",
    y = "Minimal Intergroup Bias (z-scored)",
    title = "Relationship between Ideology and Minimal Intergroup Bias",
    color = "Ideology"
  ) +
  theme_minimal() +
  annotate("text", x = Inf, y = Inf, 
           label = 
             bquote(beta[z] == .(paste(confirmatory1_beta, ",", sep =''))~'BF'[10] == .(confirmatory1_bf_long)),
           parse = FALSE,
           hjust = 1.1, vjust = 1.1, size = 5, color = "black")
  theme(plot.title = element_text(hjust = 0.5))
  confirmatory1_plot
```
  
### Confirmatory 1 Results: <span style="color:green">Ideology</span> predicts <span style="color:green">intergroup bias</span>. 
```{r confirmatory 1 results}
###FREQUENTIST
summary(confirmatory1_freqmodel)

###BAYESIAN
summary(confirmatory1_bayesmodel)
confirmatory1_bf
```
  
<br>
<br>

## Confirmatory 2: <span style="color:red">Group type</span> does **not** increase the strength of the relationship between <span style="color:red">ideology</span> and <span style="color:red">bias</span>. 
There is a main effect of the <span style="color:green">attitude</span> condition. The <span style="color:green">attitude</span> condition **weakens** the relationship between <span style="color:green">ideology</span> and <span style="color:green">bias</span>
```{r confirmatory 2 formula}
confirmatory2_formula <- mean_intergroup_bias_z ~ composite_political_orientation_z + condition + composite_political_orientation_z:condition
```
<br>

### Compute Frequentist
```{r confirmatory 2 compute frequentist}
confirmatory2_freqmodel <- lm(confirmatory2_formula, data = nhb2)
```
<br>

### Compute Bayesian
```{r confirmatory 2 compute bayesian, results = 'hide', warning=FALSE, message=FALSE }
priors_list <- get_prior(
  formula = confirmatory2_formula,
  data = nhb2,
  family = gaussian()
)
priors_list$coef #use this to get the names of the variables/their format you need to input into modelprios


confirmatory2_priors <- c(set_prior("normal(0, 0.5)", class = "b", coef="composite_political_orientation_z"),
                 set_prior("normal(0, 0.5)", class = "b", coef="conditionattitude"),
  set_prior("normal(0, 0.5)", class = "b", coef="conditionvolitional"),
  set_prior("normal(0, 0.2)", class = "b", coef="composite_political_orientation_z:conditionattitude"),
  set_prior("normal(0, 0.2)", class = "b", coef="composite_political_orientation_z:conditionvolitional")
)

confirmatory2_bayesmodel <- brms::brm(
  formula = confirmatory2_formula, 
                  data = nhb2, 
                  family = "gaussian",
                  prior = confirmatory2_priors,
                  sample_prior = "no",
                  iter = 100000,
                  warmup = 5000,
                  chains = 4,
                  seed = 987654)

confirmatory2_priordraws <- brms::brm(confirmatory2_formula, 
                        data = nhb2, 
                        family = "gaussian",
                        prior = confirmatory2_priors,
                        sample_prior = "only",
                        iter = 100000,
                        seed = 987654)

confirmatory2_bf <- bayesfactor_parameters(confirmatory2_bayesmodel,
                       prior=confirmatory2_priordraws,
                       direction = "right", 
                       parameters = "composite_political_orientation_z:condition")

```
<br>

```{r confirmatory 2 plot, echo = FALSE, results='hide', warning=FALSE, message=FALSE}
# Define the facet labels
facet_labels <- c(
  random = "Random",
  attitude = "Attitude",
  volitional = "Volitional"
)

# Calculate betas and format them with subscript z
betas <- by(nhb2, nhb2$condition, function(subdata){
  model <- lm(confirmatory1_formula, data = subdata)
  paste("beta[z] == ", round(coef(model)[2], 2))
}, simplify = FALSE)

# Create the data frame for annotations
confirmatory2_plotData <- data.frame(
  condition = names(betas),
  label = unname(unlist(betas))
)

# Ensure the condition column is a factor and matches the facet labels
confirmatory2_plotData$condition <- factor(confirmatory2_plotData$condition, levels = names(facet_labels))
nhb2$condition <- factor(nhb2$condition, levels = names(facet_labels))

# Create the plot
confirmatory2_plot <- ggplot(nhb2, aes(x = composite_political_orientation_z, y = mean_intergroup_bias_z, color = composite_political_orientation_z)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", color = "black", linetype = "solid") + # Adding the regression line
  scale_color_gradient2(low = "blue", mid = "darkgrey", high = "red", midpoint = 0) +
  labs(
    x = "Ideology (z-scored)",
    y = "Minimal Intergroup Bias (z-scored)",
    title = "Group condition as moderator",
    color = "Ideology"
  ) +
  facet_wrap(~ condition, labeller = as_labeller(facet_labels)) + # Changing facet labels
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))  + 
  geom_text(
    data = confirmatory2_plotData,
    mapping = aes(x = 0, y = 3, label = label),
    hjust = -0.1,
    vjust = -1,
    inherit.aes = FALSE,
    parse = TRUE # This ensures expressions are correctly interpreted
  )
confirmatory2_plot
```
  
### Confirmatory 2 Results: <span style="color:red">Group type</span> does <span style ="color:red">not</span> moderate relationship between <span style="color:red">ideology</span> and <span style="color:red">bias</span>. There is a main effect of the <span style="color:green">attitude</span> condition.
```{r confirmatory 2 results}
###FREQUENTIST
summary(confirmatory2_freqmodel)

###BAYESIAN
summary(confirmatory2_bayesmodel)
confirmatory2_bf
```
  
  
  
 
<br>
<br>

# Exploratory Analyses

## Summary
1. <span style="color:green">Ingroup favoritism</span> drives the relationship between <span style="color:green"> ideology and bias </span>.
2. <span style="color:red">Ideological extremity</span> does **not** predict <span style="color:red">bias</span>
3. There is **not** a interaction between <span style="color:red">ideology</span> and <span style="color:red">ideological extremity </span> in their relationship with <span style="color:red">bias</span>.
4. There **are** differences between <span style="color:green">measures of intergroup bias</span> and their relationship with <span style="color:green">ideology</span>.
<span style="color:green">Identification</span> and <span style="color:green">point distribution</span> have relationships with ideology, but <span style="color:red">trait evaluation</span> does not.
5. There **is** a difference between <span style="color:green">the measures of ideology</span> in their relationships with <span style="color:green">bias</span>. Issue-based ideology is slightly more associated with bias than self-identified ideology (e.g., "I am a conservative").
6. There are **no** differences between <span style="color:red">measures of extremity</span> and their relationship with <span style="color:red">bias</span>
7. There are mild relationships between <span style="color:green">ideology</span> and these distribution strategies: <span style="color:green">Ingroup favoritism on maximum joint profit, parity on ingroup favoritism, and ingroup favoritism on parity</span>
8. <span style="color:green">Group condition</span>, specifically the **attitude** condition, **weakens** the relationship between <span style="color:green">ideology</span> and <span style="color:green">bias</span>.
9. <span style="color:green">Need for closure</span> mediates the 16.5% of the relationship between ideology and bias.
8. <span style="color:green">Ingroup-protective morality</span> mediates 121% of the relationship between ideology and bias.
10. <span style="color:red">Perceived norms</span> does not mediate the relationship between ideology and bias.
  
  
  
  
<br>
<br>

## Exploratory 1: Does <span style="color:green">ingroup favoritism</span> or <span style="color:red">outgroup derogation</span> drive the relationship between ideology and bias?
```{r exploratory 1 formula}
exploratory1_data <- nhb2 %>%
  pivot_longer(cols = c(IngroupIndex_z, OutgroupIndex_z), names_to = "measure_type", values_to = "group_rating")
exploratory1_data$measure_type <- factor(exploratory1_data$measure_type, levels = c("OutgroupIndex_z", "IngroupIndex_z"))

exploratory1a_formula <- group_rating ~ measure_type * composite_political_orientation_z
exploratory1b_formula <- group_rating ~ measure_type * composite_ideological_extremity_z

exploratory1_bayesFormula <- group_rating ~ measure_type * composite_political_orientation_z + (1|PROLIFIC_PID)
```
<br>

### Compute Frequentist
```{r exploratory 1 compute frequentist}
exploratory1a_freqmodel <- lme(exploratory1a_formula,
                               random =~1|PROLIFIC_PID, 
                               method = "REML",
                               data = exploratory1_data) #**
exploratory1b_freqmodel <- lme(exploratory1b_formula,
                               random =~1|PROLIFIC_PID, 
                               method = "REML",
                               data = exploratory1_data)
exploratory1_simpleslopes <- emtrends(exploratory1a_freqmodel,  "measure_type", var = "composite_political_orientation_z")
```
<br>

### Compute Bayesian
```{r exploratory 1 compute bayesian, results = 'hide', warning=FALSE, message=FALSE }
exploratory1_priors <- set_prior("normal(0,2)", class="b")
exploratory1_bayesmodel <- brm(exploratory1_bayesFormula, 
                data=exploratory1_data, 
                prior = exploratory1_priors, 
                sample_prior = TRUE,
                refresh = 0,
                silent = TRUE,
                seed = 9878654)

exploratory1_bf <- bayesfactor_parameters(
                       exploratory1_bayesmodel, 
                       direction = "two-sided", 
                       parameters = "measure_type")
exploratory1_emmeans_bayes <- emmeans(exploratory1_bayesmodel, ~ composite_political_orientation_z, 
        at = list(composite_political_orientation_z = c(-2,0,2)), by = "measure_type")


```
<br>

```{r exploratory 1 plot, results='hide', echo=FALSE, warning=FALSE, message=FALSE}
conditional_effects(exploratory1_bayesmodel, "composite_political_orientation_z:measure_type", int_conditions = list(type=c(0,1)))
```
 
### Exploratory 1 Results: <span style="color:green">Ingroup favoritism</span> drives the relationship between ideology and bias.
Ingroup favoritism is correlated with ideology, but outgroup derogation is not.
```{r exploratory 1 results}
###FREQUENTIST
summary(exploratory1a_freqmodel)
exploratory1_simpleslopes
pairs(exploratory1_simpleslopes)
testSlopesBinaryInteraction(exploratory1a_freqmodel)
summary(exploratory1b_freqmodel)

###BAYESIAN
summary(exploratory1_bayesmodel)
exploratory1_bf
exploratory1_emmeans_bayes
hypothesis(exploratory1_bayesmodel,
           c(Ideology = "composite_political_orientation_z=0", # this is the slope of the type=0 line in the plot before
             IngroupFavoritism = "composite_political_orientation_z + measure_typeIngroupIndex_z:composite_political_orientation_z = 0") 
)


```
  
  
  
<br>
<br>

## Exploratory 2: Does <span style="color:red">ideological extremity</span> predict <span style="color:red">bias</span>?
```{r exploratory 2}
exploratory2_formula <- mean_intergroup_bias_z ~ composite_ideological_extremity_z
```
<br>

### Compute Frequentist
```{r exploratory 2 compute frequentist}
exploratory2_freqmodel <- lm(exploratory2_formula, data = nhb2)
```
<br> 

### Compute Bayesian
```{r exploratory 2 compute bayesian, results = 'hide', warning=FALSE, message=FALSE }
# Define priors for the regression model
exploratory2_priors <- c(set_prior("normal(0, 0.5)", class = "b"))

# Run the regression model
exploratory2_bayesmodel<- brm(
  formula = exploratory2_formula, 
  data = nhb2, 
  family = gaussian(),
  prior = exploratory2_priors,
  sample_prior = "no",
  iter = 100000,  # Adjust iterations based on convergence diagnostics
  chains = 4,
  seed = 987654,
  warmup = 5000,
  refresh = 0,
  silent = TRUE
)


exploratory2_priordraws <- brms::brm(exploratory2_formula, 
                                data = nhb2, 
                                family = "gaussian",
                                prior = exploratory2_priors,
                                sample_prior = "only",
                                refresh = 0,
                                silent = TRUE,
                                seed = 987654,
                                iter = 100000)

exploratory2_bf <- bayesfactor_parameters(
                       exploratory2_bayesmodel,
                       prior=exploratory2_priordraws, 
                       direction = "two-sided", 
                       parameters = "composite_ideological_extremity_z")
```
<br>

```{r exploratory 2 plot,results='hide', echo=FALSE, warning=FALSE, message=FALSE}
exploratory2_bf_long <- round(exp(exploratory2_bf$log_BF), 2) %>% as.character()
exploratory2_beta <- unname(round(exploratory2_freqmodel$coefficients[2],2))
exploratory2_plot <- ggplot(nhb2, aes(x = composite_ideological_extremity_z, y = mean_intergroup_bias_z, 
                                       color = composite_ideological_extremity_z)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", color = "black", linetype = "solid") +
  scale_color_gradient2(low = "grey", mid = "pink", high = "red1", midpoint = 0) +
  labs(
    x = "Ideological Extremity (z-scored)",
    y = "Minimal Intergroup Bias (z-scored)",
    title = "Relationship between Ideological Extremity and Minimal Intergroup Bias",
    color = "Extremity"
  ) +
  theme_minimal() +
  annotate("text", x = Inf, y = Inf, 
           label = 
             bquote(beta[z] == .(paste(exploratory2_beta, ",", sep =""))~'BF'[10] == .(exploratory2_bf_long)),
           parse = FALSE,
           hjust = 1.1, vjust = 1.1, size = 5, color = "black")
  theme(plot.title = element_text(hjust = 0.5))
  exploratory2_plot
```

### Exploratory 2 Results: <span style="color:red">Ideological extremity</span> does **not** predict <span style="color:red">bias</span>
```{r exploratory 2 results}
###FREQUENTIST
summary(exploratory2_freqmodel)
summary(exploratory2_bayesmodel)

###BAYESIAN
1/exp(exploratory2_bf$log_BF)
```
  
  
  
  
<br>
<br>

## Exploratory 3: Is there an interaction between <span style="color:red">ideological extremity</span> and <span style="color:red">ideology</span> on <span style="color:green">bias</span>?
```{r exploratory 3 formula}
exploratory3_formula <- mean_intergroup_bias_z ~ composite_political_orientation_z * composite_ideological_extremity_z
```
<br>

### Compute Frequentist
```{r exploratory 3 compute frequentist}
exploratory3_freqmodel          <- lm(exploratory3_formula, data = nhb2)
exploratory3_freqmodel_cons  <- lm(exploratory2_formula, data = subset(nhb2, nhb2$composite_political_orientation_z > 1))
exploratory3_freqmodel_libs <- lm(exploratory2_formula, data = subset(nhb2, nhb2$composite_political_orientation_z < -1))
```
<br>

### Compute Bayesian
```{r exploratory 3 compute bayesian, results = 'hide', warning=FALSE, message=FALSE}
exploratory3_priors<- set_prior("normal(0, 5)", class = "b")

# Fit the model using brms
exploratory3_bayesmodel <- brm(
  formula = exploratory3_formula,
  data = nhb2,
  family = gaussian(),
  prior = exploratory3_priors,
  sample_prior = "no",
  iter = 100000,
  chains = 4,
  seed = 987654,
  warmup = 5000,
  refresh = 0,
  silent = TRUE
)

exploratory3_priordraws <- brms::brm(exploratory3_formula, 
                                        data = nhb2, 
                                        family = "gaussian",
                                        prior = exploratory3_priors,
                                        sample_prior = "only",
                                        seed = 987654,
                                        iter = 100000,
                                        refresh = 0,
                                        silent = TRUE)


exploratory3_bf <- bayesfactor_parameters(exploratory3_bayesmodel,
                       prior=exploratory3_priordraws, 
                       direction = "two-sided", 
                       parameters = "composite_political_orientation_z:composite_ideological_extremity_z")
```
<br>

```{r exploratory 3 plot, results='hide', echo=FALSE, warning=FALSE, message=FALSE}
# Create the plot
exploratory3_bf_long <- round(exp(exploratory3_bf$log_BF), 2) %>% as.character()
exploratory3_beta <- unname(round(exploratory3_freqmodel$coefficients[2],2))
exploratory3_plot <- ggplot(nhb2, aes(x = composite_political_orientation_z, y = mean_intergroup_bias_z, color = composite_ideological_extremity_z)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", aes(color = composite_ideological_extremity_z), formula = y ~ x * composite_ideological_extremity_z, linetype = "solid")  +
  scale_color_gradient2(low = "grey97", mid = "pink", high = "red1", midpoint = 0) +
  labs(
    x = "Ideology (z-scored)",
    y = "Minimal Intergroup Bias (z-scored)",
    title = "Interaction between Ideology and Ideological Extremity on Minimal Intergroup Bias",
    color = "Ideological Extremity"
  ) +
  theme_minimal() +
  annotate("text", x = Inf, y = Inf, 
           label = bquote(beta[z] == .(paste(exploratory3_beta, ",", sep =''))~'BF'[10] == .(exploratory3_bf_long)),
           parse = FALSE,
           hjust = 1.1, vjust = 1.1, size = 5, color = "black") +
  theme(plot.title = element_text(hjust = 0.5))


exploratory3_plot2 <- interact_plot(exploratory3_freqmodel, 
              modx = composite_political_orientation_z, 
              pred = composite_ideological_extremity_z,
              legend.main = "Ideology",
              modx.labels = c("Liberal leaning (SD -1)", "Middle", "Conservative leaning (SD +1"))+
  labs(x = "Extremity",
       y = "Intergroup Bias",
       title = "Interaction between extremity and ideology") +
  annotate("text", x = Inf, y = Inf, 
           label = bquote(beta[z] == .(paste(exploratory3_beta, ",", sep =''))~'BF'[10] == .(exploratory3_bf_long)),
           parse = FALSE,
           hjust = 1.1, vjust = 1.1, size = 5, color = "black")
exploratory3_plot
exploratory3_plot2
```
  
### Exploratory 3 Results: There is **not** a interaction between <span style="color:red">ideology</span> and <span style="color:red">ideological extremity </span> in their relationship with <span style="color:red">bias</span>.
```{r exploratory 3 results, warning=FALSE}
###FREQUENTIST
summary(exploratory3_freqmodel)
summary(exploratory3_freqmodel_cons) #Among more conservative participants, there's no relationship between extremity and bias.
summary(exploratory3_freqmodel_libs) #Among more liberal participants, there's a negative relationship between extremity and bias.

###BAYESIAN
summary(exploratory3_bayesmodel)
exp(exploratory3_bf$log_BF)
```
  
  
  
  
<br>
<br>

## Exploratory 4: Are differences between <span style="color:green">measures of intergroup bias</span> and their relationship with <span style="color:green">ideology</span>?
```{r exploratory 4 formula}
exploratory4_data <- nhb2 %>%
  pivot_longer(cols = c(z_total_ingroup_minus_outgroup_points,z_ingroup_minus_outgroup_traits_positive,z_ingroup_minus_outgroup_identify), names_to = "measure_type", values_to = "group_rating") %>% 
  mutate(measure_type = dplyr::recode(measure_type, 
                               z_total_ingroup_minus_outgroup_points    = "points",
                               z_ingroup_minus_outgroup_traits_positive = "traits",
                               z_ingroup_minus_outgroup_identify        = "identification"))
exploratory4_data$measure_type <- factor(exploratory4_data$measure_type, levels = c("traits", "points", "identification"))

exploratory4a_formula <- group_rating ~ measure_type * composite_political_orientation_z
exploratory4b_formula <- group_rating ~ measure_type * composite_ideological_extremity_z

exploratory4_bayesFormula <- group_rating ~ measure_type * composite_political_orientation_z + (1|PROLIFIC_PID)
```
<br>

### Compute Frequentist
```{r exploratory 4 compute frequentist}
exploratory4a_freqmodel <- lme(exploratory4a_formula,
                               random =~1|PROLIFIC_PID,
                               method = "REML",
                               data = exploratory4_data) #**
exploratory4b_freqmodel <- lme(exploratory4b_formula,
                               random =~1|PROLIFIC_PID, 
                               method = "REML",
                               data = exploratory4_data)
exploratory4_simpleslopes <- emtrends(exploratory4a_freqmodel,  "measure_type", var = "composite_political_orientation_z")
```
<br>

### Compute Bayesian
```{r exploratory 4 compute bayesian, results = 'hide', warning=FALSE, message=FALSE }
exploratory4_priors <- set_prior("normal(0,2)", class="b")
exploratory4_bayesmodel <- brm(exploratory4_bayesFormula, 
                data=exploratory4_data, 
                prior = exploratory4_priors, 
                sample_prior = TRUE,
                refresh = 0,
                silent = TRUE,
                seed = 9878654)

exploratory4_bf <- bayesfactor_parameters(
                       exploratory4_bayesmodel, 
                       direction = "two-sided", 
                       parameters = "measure_type")
exploratory4_emmeans_bayes <- emmeans(exploratory4_bayesmodel, ~ composite_political_orientation_z, 
        at = list(composite_political_orientation_z = c(-2,0,2)), by = "measure_type")
```
<br> 

```{r exploratory 4 plot, results='hide', echo=FALSE, warning=FALSE, message=FALSE}
conditional_effects(exploratory4_bayesmodel, "composite_political_orientation_z:measure_type", int_conditions = list(type=c(0,1)))
```
  
### Exploratory 4 Results: There are differences between <span style="color:green">measures of intergroup bias</span> and their relationship with <span style="color:green">ideology</span>.
<span style="color:green">Identification</span> and <span style="color:green">point distribution</span> have relationships with ideology, but <span style="color:red">trait evaluation</span> does not.
```{r exploratory 4 results}
###FREQUENTIST
summary(exploratory4a_freqmodel)
exploratory4_simpleslopes
pairs(exploratory4_simpleslopes)
testSlopesBinaryInteraction(exploratory4a_freqmodel)
summary(exploratory4b_freqmodel)

###BAYESIAN
summary(exploratory4_bayesmodel)
exploratory4_bf
exploratory4_emmeans_bayes
hypothesis(exploratory4_bayesmodel,
           c(Ideology = "composite_political_orientation_z=0", # this is the slope of the type=0 line in the plot before
             Identification = "composite_political_orientation_z + measure_typeidentification:composite_political_orientation_z = 0",
             Points = "composite_political_orientation_z + measure_typepoints:composite_political_orientation_z = 0") # this is the slope of the type=1 line in the plot before
)



```
  
  
  
  
<br>
<br>

## Exploratory 5: Are there differences between <span style="color:green">measures of ideology</span> and their relationship with <span style="color:green"> bias</span>?
```{r exploratory 5 formula}
exploratory5_data <- nhb2 %>%
  pivot_longer(cols = c(self_identification_political_z, z_mean_SECS), names_to = "measure_type", values_to = "ideology_rating") %>% 
  mutate(measure_type = dplyr::recode(measure_type, 
                               self_identification_political_z    = "self_report",
                               z_mean_SECS = "issue_based"))
exploratory5_data$measure_type <- factor(exploratory5_data$measure_type, levels = c("self_report", "issue_based"))


exploratory5_formula <- ideology_rating ~ mean_intergroup_bias_z * measure_type
exploratory5_bayesFormula <- ideology_rating ~ mean_intergroup_bias_z * measure_type + (1|PROLIFIC_PID)
```
<br>

### Compute Frequentist
```{r exploratory 5 compute frequentist}
exploratory5_freqmodel <- lme(exploratory5_formula,
                               random =~1|PROLIFIC_PID, 
                               method = "REML",
                               data = exploratory5_data,
                               na.action = na.omit) #**
exploratory5_simpleslopes <- emtrends(exploratory5_freqmodel,  "measure_type", var = "mean_intergroup_bias_z")
```
<br>

### Compute Bayesian
```{r exploratory 5 compute bayesian, results = 'hide', warning=FALSE, message=FALSE }
exploratory5_priors <- set_prior("normal(0,2)", class="b")
exploratory5_bayesmodel <- brm(exploratory5_bayesFormula, 
                data=exploratory5_data, 
                prior = exploratory5_priors, 
                sample_prior = TRUE,
                refresh = 0,
                silent = TRUE,
                seed = 9878654)

exploratory5_bf <- bayesfactor_parameters(
                       exploratory5_bayesmodel, 
                       direction = "two-sided", 
                       parameters = "measure_type")

exploratory5_emmeans_bayes <- emmeans(exploratory5_bayesmodel, ~ mean_intergroup_bias_z, 
        at = list(mean_intergroup_bias_z = c(-2,0,2)), by = "measure_type")

```
<br>

```{r exploratory 5 plot, results='hide', echo=FALSE, warning=FALSE, message=FALSE}
conditional_effects(exploratory5_bayesmodel, "mean_intergroup_bias_z:measure_type", int_conditions = list(type=c(0,1)))
```
  
### Exploratory 5 Results: There **is** a difference between <span style="color:green">the measures of ideology</span> and their relationships with <span style="color:green">bias</span>. 
Issue-based ideology is more correlated with bias than self-identification-based ideology.
```{r exploratory 5 results}
###FREQUENTIST
summary(exploratory5_freqmodel)
exploratory5_simpleslopes
pairs(exploratory5_simpleslopes)
testSlopesBinaryInteraction(exploratory5_freqmodel)

###BAYESIAN
summary(exploratory5_bayesmodel)
exploratory5_bf
exploratory5_emmeans_bayes
hypothesis(exploratory5_bayesmodel,
           c(Bias = "mean_intergroup_bias_z=0", # this is the slope of the type=0 line in the plot before
             Issue_Based = "mean_intergroup_bias_z + mean_intergroup_bias_z:measure_typeissue_based = 0") # this is the slope of the type=1 line in the plot before
)

```
  
  
  
<br>
<br>

## Exploratory 6: Are there differences between <span style="color:red">measures of extremity</span> and their relationship with <span style="color:red">bias</span>?    
```{r exploratory 6 formula}
exploratory6_data <- nhb2 %>%
  pivot_longer(cols = c(selfIDExtremity_z, z_SECSExtremity), names_to = "measure_type", values_to = "extremity_rating") %>% 
  mutate(measure_type = dplyr::recode(measure_type, 
                               selfIDExtremity_z    = "self_report",
                               z_SECSExtremity = "issue_based"))


exploratory6_data$extremity_rating <- scale(exploratory6_data$extremity_rating)
exploratory6_data$measure_type <- factor(exploratory6_data$measure_type, levels = c("self_report", "issue_based"))

exploratory6_formula <- extremity_rating ~ mean_intergroup_bias_z * measure_type

exploratory6_bayesFormula <- extremity_rating ~ mean_intergroup_bias_z * measure_type + (1|PROLIFIC_PID)
```
<br>

### Compute Frequentist
```{r exploratory 6 compute frequentist}
exploratory6_freqmodel <- lme(exploratory6_formula,
                               random =~1|PROLIFIC_PID, 
                               method = "REML",
                               data = exploratory6_data,
                               na.action = na.omit) #**
exploratory6_simpleslopes <- emtrends(exploratory6_freqmodel,  "measure_type", var = "mean_intergroup_bias_z")
```
  
<br>

### Compute Bayesian
```{r exploratory 6 compute bayesian, results = 'hide', warning=FALSE, message=FALSE }
exploratory6_priors <- set_prior("normal(0,2)", class="b")
exploratory6_bayesmodel <- brm(exploratory6_bayesFormula, 
                data=exploratory6_data, 
                prior = exploratory6_priors, 
                sample_prior = TRUE,
                refresh = 0,
                silent = TRUE,
                seed = 9878654)

exploratory6_bf <- bayesfactor_parameters(
                       exploratory6_bayesmodel, 
                       direction = "two-sided", 
                       parameters = "measure_type")
exploratory6_emmeans_bayes <- emmeans(exploratory6_bayesmodel, ~ mean_intergroup_bias_z, 
        at = list(mean_intergroup_bias_z = c(-2,0,2)), by = "measure_type")
```
<br>

```{r exploratory 6 plot, results='hide', echo=FALSE, warning=FALSE, message=FALSE}
conditional_effects(exploratory6_bayesmodel, "mean_intergroup_bias_z:measure_type", int_conditions = list(type=c(0,1)))
```
  
### Exploratory 6 Results: There are **no** differences between <span style="color:red">measures of extremity</span> and their relationship with <span style="color:red">bias</span>
```{r exploratory 6 results}
###FREQUENTIST
summary(exploratory6_freqmodel)
exploratory6_simpleslopes
pairs(exploratory6_simpleslopes)
testSlopesBinaryInteraction(exploratory6_freqmodel)

###BAYESIAN
summary(exploratory6_bayesmodel)
exploratory6_bf

exploratory6_emmeans_bayes
hypothesis(exploratory6_bayesmodel,
           c(Bias = "mean_intergroup_bias_z=0", # this is the slope of the type=0 line in the plot before
             Issue_Based = "mean_intergroup_bias_z + mean_intergroup_bias_z:measure_typeissue_based = 0") # this is the slope of the type=1 line in the plot before
)

```
<br>
<br> 

## Exploratory 7: Are there relationships between different <span style="color:green">pull scores</span> and <span style="color:green">ideology</span>?
```{r exploratory 7 data}
exploratory7_data <- nhb2[, c("composite_political_orientation_z", 
  "Pull_FAVonMJP",
  "Pull_MJPonFAV",
  "Pull_MDonProfit",
  "Pull_ProfitonMD",
  "Pull_PonFAV",
  "Pull_FAVonP")]
names(exploratory7_data) <- c("Ideology",   
                         "FAVonMJP",
                         "MJPonFAV",
                         "MDonProfit",
                         "ProfitonMD",
                         "PonFAV",
                         "FAVonP")

```
<br>

#### Compute Frequentist
```{r exploratory 7 compute frequentist}
exploratory7_cor <- rcorr(as.matrix(exploratory7_data))
```
<br>

#### Compute Bayesian
```{r exploratory 7 compute bayesian, results = 'hide', warning=FALSE, message=FALSE }
exploratory7_bfs <- c()
exploratory7_cols <- c()
exploratory7_bayessummaries <- list()
for (taj in names(exploratory7_data)[-1]){
  thisBF <- correlationBF(exploratory7_data[, 'Ideology'], exploratory7_data[, taj])
  samples <- posterior(thisBF, iterations = 100000)
  exploratory7_bayessummaries[taj] <- summary(samples)
  thisBF            <- exp(thisBF@bayesFactor$bf)
  exploratory7_bfs  <- c(exploratory7_bfs, thisBF) 
  exploratory7_cols <- c(exploratory7_cols, taj)
}

exploratory7_bayescor <- data.frame(Pull = exploratory7_cols,
                                    BF = exploratory7_bfs)
```
<br>

```{r exploratory 7 plot, results='hide', echo=FALSE, warning=FALSE, message=FALSE}
corrplot(exploratory7_cor$r, type="upper", order="original", 
         tl.srt = 25, diag = FALSE, method = "color",
         p.mat = exploratory7_cor$P, sig.level = 0.05, insig = "label_sig")
```

#### Exploratory 7 Results: There are mild relationships between <span style="color:green">ideology</span> and these distribution strategies: <span style="color:green">Ingroup favoritism on maximum joint profit, maximum joint profit on ingroup favoritism, and ingroup favoritism on parity <span>
```{r exploratory 7 results}
##FREQUENTIST
exploratory7_cor

##BAYESIAN
exploratory7_bayescor
exploratory7_bayessummaries
```
<br>
<br>

## Exploratory 8: Is there any moderation of <span style="color:green">group condition</span> on the relationship between <span style="color:green">ideology</span> and <span style="color:green">bias</span>?
<br>

### Compute Bayesian
```{r exploratory 8 compute bayesian, results='hide', warning=FALSE, message=FALSE}
exploratory8_bf <- bayesfactor_parameters(confirmatory2_bayesmodel,
                       prior=confirmatory2_priordraws,
                       direction = "two-sided", 
                       parameters = "composite_political_orientation_z:condition")
exploratory8_bf_left <- bayesfactor_parameters(confirmatory2_bayesmodel,
                       prior=confirmatory2_priordraws,
                       direction = "left", 
                       parameters = "composite_political_orientation_z:condition")
```
<br>

```{r exploratory 8 plot, results='hide', echo=FALSE, warning=FALSE, message=FALSE}
confirmatory2_plot
```

### Exploratory 8 Results: <span style="color:green">Group condition</span> **weakens** the relationship between <span style="color:green">ideology</span> and <span style="color:green">bias</span>
```{r exploratory 8 results}
###FREQUENTIST
summary(confirmatory2_freqmodel)

###BAYESIAN
summary(confirmatory2_bayesmodel)
exploratory8_bf_left #Testing left-sided hypotheses
exploratory8_bf #Testing two-sided hypothesis
```
<br>
<br>

## Exploratory 9: Does <span style="color:green">need for closure</span> mediate the relationship between ideology and bias?
<br> 

### Compute Frequentist
```{r exploratory 9 compute frequentist}
mediator_model <- lm(closure_z ~ composite_political_orientation_z, data = nhb2)
outcome_model <- lm(mean_intergroup_bias_z ~ composite_political_orientation_z + closure_z, data = nhb2)
exploratory9_freqmodel <- mediation::mediate(mediator_model, outcome_model, treat = "composite_political_orientation_z", mediator = "closure_z")

```
<br>

### Compute Bayesian
```{r exploratory 9 compute bayesian, message=FALSE, warning=FALSE, error = FALSE, results='hide'}
# Define mediation model
f1 <- brms::bf(closure_z ~ composite_political_orientation_z)
f2 <- brms::bf(mean_intergroup_bias_z ~ composite_political_orientation_z + closure_z)

# Set prior on regression coefficients (necessary for BF calculation)
priors_med <- c(set_prior("normal(0, 1)", class = "b"))

# Run Mediation model
exploratory9_bayesmodel <- brm(f1+f2+set_rescor(FALSE), 
                                  iter = 100000,
                                  chains = 4,
                                  data = nhb2,
                                  prior = priors_med,
                                  seed = 987654,
                                  warmup = 5000,
                                  save_pars = save_pars(all = TRUE))
# Estimates for direct, indirect, total effect
med_closure <- mediation(exploratory9_bayesmodel, centrality = "mean")

# Extract samples
med_closure_samples_posterior <- as_draws_array(exploratory9_bayesmodel)

# Compute indirect effect coefficient
med_closure_samples_posterior_indirect <- med_closure_samples_posterior[,,"b_closurez_composite_political_orientation_z"]*med_closure_samples_posterior[,,"b_meanintergroupbiasz_closure_z"]
set.seed(987654)
med_closure_samples_prior_indirect <- rnorm(95000*4, 0, 1)*rnorm(95000*4, 0, 1)

# Compute total effect coefficient
med_closure_samples_posterior_total <- med_closure_samples_posterior[,,"b_meanintergroupbiasz_composite_political_orientation_z"]+med_closure_samples_posterior_indirect
set.seed(987654)
med_closure_samples_prior_total <- rnorm(95000*4, 0, 1)+med_closure_samples_prior_indirect

# Bayes factor direct effect (BF10)
posterior_direct_med_closure <- logspline(med_closure_samples_posterior[,,"b_meanintergroupbiasz_composite_political_orientation_z"])
bf_direct_med_closure <- dnorm(0, 0, 1) / dlogspline(0, posterior_direct_med_closure)

# Bayes factor indirect effect (BF10)
posterior_indirect_med_closure <- logspline(med_closure_samples_posterior_indirect)
prior_indirect_med_closure <- logspline(med_closure_samples_prior_indirect)
bf_indirect_med_closure <- dlogspline(0, prior_indirect_med_closure) / dlogspline(0, posterior_indirect_med_closure)

# Bayes factor mediator effect (BF10)
posterior_mediator_med_closure <- logspline(med_closure_samples_posterior[,,"b_meanintergroupbiasz_closure_z"])
bf_mediator_med_closure <- dnorm(0, 0, 1) / dlogspline(0, posterior_mediator_med_closure)

# Bayes factor total effect (BF10)
posterior_total_med_closure <- logspline(med_closure_samples_posterior_total)
prior_total_med_closure <- logspline(med_closure_samples_prior_total)
bf_total_med_closure <- dlogspline(0, prior_total_med_closure) / dlogspline(0, posterior_total_med_closure)

```
<br>

### Exploratory 9 Results: <span style="color:green">Need for closure</span> mediates the 16.5% of the relationship between ideology and bias.
```{r exploratory 9 results}
#FREQUENTIST
summary(exploratory9_freqmodel)

#BAYESIAN
summary(exploratory9_bayesmodel)
bf_direct_med_closure
bf_indirect_med_closure
bf_mediator_med_closure
bf_total_med_closure
```
  
  
  
  
  
  
<br>
<br>

## Exploratory 10: Does <span style="color:green">ingroup-protective morality</span> mediate the relationship between ideology and bias?
<br>

#### Compute Frequentist
```{r exploratory 10 compute frequentist}
mediator_model <- lm(mf_z ~ composite_political_orientation_z, data = nhb2)
outcome_model <- lm(mean_intergroup_bias_z ~ composite_political_orientation_z + mf_z, data = nhb2)
exploratory10_freqmodel <- mediation::mediate(mediator_model, outcome_model, treat = "composite_political_orientation_z", mediator = "mf_z")
```
   
<br>

#### Compute Bayesian
```{r exploratory 10 compute bayesian, message=FALSE, warning=FALSE, error = FALSE, results = 'hide'}
# Define mediation model
f1 <- brms::bf(mf_z ~ composite_political_orientation_z)
f2 <- brms::bf(mean_intergroup_bias_z ~ composite_political_orientation_z + mf_z)

# Set prior on regression coefficients (necessary for BF calculation)
priors_med <- c(set_prior("normal(0, 1)", class = "b"))

# Run Mediation model
exploratory10_bayesmodel <- brm(f1+f2+set_rescor(FALSE), 
                                  iter = 100000,
                                  chains = 4,
                                  data = nhb2,
                                  prior = priors_med,
                                  seed = 987654,
                                  warmup = 5000,
                                  save_pars = save_pars(all = TRUE))

# Estimates for direct, indirect, total effect
med_mf <- mediation(exploratory10_bayesmodel, centrality = "mean")

# Extract samples
med_mf_samples_posterior <- as_draws_array(exploratory10_bayesmodel)

# Compute indirect effect coefficient
med_mf_samples_posterior_indirect <- med_mf_samples_posterior[,,"b_mfz_composite_political_orientation_z"]*med_mf_samples_posterior[,,"b_meanintergroupbiasz_mf_z"]
set.seed(987654)
med_mf_samples_prior_indirect <- rnorm(95000*4, 0, 1)*rnorm(95000*4, 0, 1)

# Compute total effect coefficient
med_mf_samples_posterior_total <- med_mf_samples_posterior[,,"b_meanintergroupbiasz_composite_political_orientation_z"]+med_mf_samples_posterior_indirect
set.seed(987654)
med_mf_samples_prior_total <- rnorm(95000*4, 0, 1)+med_mf_samples_prior_indirect

# Bayes factor direct effect (BF10)
posterior_direct_med_mf <- logspline(med_mf_samples_posterior[,,"b_meanintergroupbiasz_composite_political_orientation_z"])
bf_direct_med_mf <- dnorm(0, 0, 1) / dlogspline(0, posterior_direct_med_mf)
bf_direct_med_mf

# Bayes factor indirect effect (BF10)
posterior_indirect_med_mf <- logspline(med_mf_samples_posterior_indirect)
prior_indirect_med_mf <- logspline(med_mf_samples_prior_indirect)
bf_indirect_med_mf <- dlogspline(0, prior_indirect_med_mf) / dlogspline(0, posterior_indirect_med_mf)
bf_indirect_med_mf

# Bayes factor mediator effect (BF10)
posterior_mediator_med_mf <- logspline(med_mf_samples_posterior[,,"b_meanintergroupbiasz_mf_z"])
bf_mediator_med_mf <- dnorm(0, 0, 1) / dlogspline(0, posterior_mediator_med_mf)
bf_mediator_med_mf

# Bayes factor total effect (BF10)
posterior_total_med_mf <- logspline(med_mf_samples_posterior_total)
prior_total_med_mf <- logspline(med_mf_samples_prior_total)
bf_total_med_mf <- dlogspline(0, prior_total_med_mf) / dlogspline(0, posterior_total_med_mf)
bf_total_med_mf
```
  
<br>

#### Exploratory 10 Results: <span style="color:green">Ingroup-protective morality</span> mediates 121% of the relationship between ideology and bias.
```{r exploratory 10 results}
#FREQUENTIST
summary(exploratory10_freqmodel)

#BAYESIAN
summary(exploratory10_bayesmodel)
bf_direct_med_mf
bf_indirect_med_mf
bf_mediator_med_mf
bf_total_med_mf
```
<br>
<br>

## Exploratory 11: Do <span style="color:red">perceived norms</span> mediate the relationship between ideology and bias?
<br>

#### Compute Frequentist
```{r exploratory 11 compute frequentist}
mediator_model <- lm(social_norms_z ~ composite_political_orientation_z, data = nhb2)
outcome_model <- lm(mean_intergroup_bias_z ~ composite_political_orientation_z + social_norms_z, data = nhb2)
exploratory11_freqmodel <- mediation::mediate(mediator_model, outcome_model, treat = "composite_political_orientation_z", mediator = "social_norms_z")
```

<br>

#### Compute Bayesian
```{r exploratory 11 compute bayesian, message=FALSE, warning=FALSE, error = FALSE, results='hide'}
# Define mediation model
f1 <- brms::bf(social_norms_z ~ composite_political_orientation_z)
f2 <- brms::bf(mean_intergroup_bias_z ~ composite_political_orientation_z + social_norms_z)

# Set prior on regression coefficients (necessary for BF calculation)
priors_med <- c(set_prior("normal(0, 1)", class = "b"))

# Run Mediation model
exploratory11_bayesmodel <- brm(f1+f2+set_rescor(FALSE), 
                                  iter = 100000,
                                  chains = 4,
                                  data = nhb2,
                                  prior = priors_med,
                                  seed = 987654,
                                  warmup = 5000,
                                  save_pars = save_pars(all = TRUE))
# Estimates for direct, indirect, total effect
med_social_norms <- mediation(exploratory11_bayesmodel, centrality = "mean")

# Extract samples
med_social_norms_samples_posterior <- as_draws_array(exploratory11_bayesmodel)

# Compute indirect effect coefficient
med_social_norms_samples_posterior_indirect <- med_social_norms_samples_posterior[,,"b_socialnormsz_composite_political_orientation_z"]*med_social_norms_samples_posterior[,,"b_meanintergroupbiasz_social_norms_z"]
set.seed(987654)
med_social_norms_samples_prior_indirect <- rnorm(95000*4, 0, 1)*rnorm(95000*4, 0, 1)

# Compute total effect coefficient
med_social_norms_samples_posterior_total <- med_social_norms_samples_posterior[,,"b_meanintergroupbiasz_composite_political_orientation_z"]+med_social_norms_samples_posterior_indirect
set.seed(987654)
med_social_norms_samples_prior_total <- rnorm(95000*4, 0, 1)+med_social_norms_samples_prior_indirect

# Bayes factor direct effect (BF10)
posterior_direct_med_social_norms <- logspline(med_social_norms_samples_posterior[,,"b_meanintergroupbiasz_composite_political_orientation_z"])
bf_direct_med_social_norms <- dnorm(0, 0, 1) / dlogspline(0, posterior_direct_med_social_norms)

# Bayes factor indirect effect (BF10)
posterior_indirect_med_social_norms <- logspline(med_social_norms_samples_posterior_indirect)
prior_indirect_med_social_norms <- logspline(med_social_norms_samples_prior_indirect)
bf_indirect_med_social_norms <- dlogspline(0, prior_indirect_med_social_norms) / dlogspline(0, posterior_indirect_med_social_norms)

# Bayes factor mediator effect (BF10)
posterior_mediator_med_social_norms <- logspline(med_social_norms_samples_posterior[,,"b_meanintergroupbiasz_social_norms_z"])
bf_mediator_med_social_norms <- dnorm(0, 0, 1) / dlogspline(0, posterior_mediator_med_social_norms)

# Bayes factor total effect (BF10)
posterior_total_med_social_norms <- logspline(med_social_norms_samples_posterior_total)
prior_total_med_social_norms <- logspline(med_social_norms_samples_prior_total)
bf_total_med_social_norms <- dlogspline(0, prior_total_med_social_norms) / dlogspline(0, posterior_total_med_social_norms)
```
  
<br>

#### Exploratory 11 Results: <span style="color:red">Perceived norms</span> does not mediate the relationship between ideology and bias.
```{r exploratory 11 results}
#FREQUENTIST
summary(exploratory11_freqmodel)

#BAYESIAN
summary(exploratory11_bayesmodel)
bf_direct_med_social_norms
bf_indirect_med_social_norms
bf_mediator_med_social_norms
bf_total_med_social_norms
```
